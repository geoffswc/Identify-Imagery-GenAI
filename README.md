# Smoking-Detection
Detection of Smoking in Video Media, Audio and Visual

## Overview

This repository contains code and data related to identification of smoking in video media.

The approach uses a hybrid of open source technology and generative AI to identify smoking in video and audio tracks.
* The video approach splits a video into image frames at 1 second intervals, then uses Versa to identify smoking related imagery in each frame
* The audio approach uses Whisper to extract a transcript with time stamps, then uses Versa to identify whether the transcript involves smoking related themes.

## Technologies

This project uses both Google Colab and Versa. All video files are public domain. Note that GPUs available on Colab can greatly increase processing speed, especially for audio-to-text transcription using Whisper. The approach uses Colab for video and audio processing, then Versa on RAE for analyzing the image frames and transcript for smoking-related content.

## Workbooks

### Video Pipeline

The process for identifying smoking visually in a video involves two workboks.

#### Download_Frames.ipynb 

This workbook (run on Colab) uses cv2 to extract frames from a video at a rate of 1 frame per second

#### Extract_Frames_From_Local.ipynb 

Same as Download_Frames.ipynb, except that the workbook prompts for a video uploaded from local storage (apologies for naming inconsistency).

#### Detect_Smoking_Visual

This workbook (run on RAE) uses the image object detection API in Versa to determine if smoking is present and to provide a short context for how this determination is made.

### Audio Pipeline

#### Whisper_Transcribe_TimeStamp.ipynb

This workbook (run on Colab) uses Whisper locally to extract a text transcript from a video (available as a public URI). It produces a csv file that contains a transcript split into short intervals and the time stamp. 

#### Identify-Tobacco-In-Transcript.ipynb

Use Versa to identify tobacco related language in the audio transcript

### Test Video

This repository contains output for a Camel smoking advertisement from the industry archives. The video is available here:

https://ia601201.us.archive.org/0/items/CamelFilters/Camel%20filters.mp4

### Output Files

#### visual_smoking_detection.csv

CSV file containing 
* name of the video frame (name of video + sequence in video + timestamp in video)
* whether smoking is present (yes/no or whatever GenAI decided was equivalent)
* short_description of image where smoking is present

#### transcription_smoking_detection.csv

CSV file containing
* the video file_name
* time_stamp (in video)
* transcription (audio-to-text for that interval)
* smoking_mentioned (yes/no for that interval)
* smoking_context (the context in which smoking or related topic was mentioned)

#### camel_transcripts/transcription_camel.csv

The transcription file with two added columns (generated by Versa)
* smoking_mentioned (yes/no)
* smoking_content (brief desciption of smoking-related language, if present)

#### sample_output.json

Sample output from Versa (ChatGPT) image recognition.  
Displays the response to an image from a Camel TV advertisement, analyzed by Versa with a prompt to identify tobacco related imagery
Response rendered as JSON





